
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Evaluation framework for goal-seeking AI agents -- memory recall, tool use, planning, and reasoning across progressive difficulty levels">
      
      
      
        <link rel="canonical" href="https://rysweet.github.io/amplihack-agent-eval/self-improvement/">
      
      
        <link rel="prev" href="../adapters/">
      
      
        <link rel="next" href="../multi-agent-eval/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>Self-Improvement Loop - amplihack-agent-eval</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#self-improvement-loop" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="amplihack-agent-eval" class="md-header__button md-logo" aria-label="amplihack-agent-eval" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            amplihack-agent-eval
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Self-Improvement Loop
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rysweet/amplihack-agent-eval" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    rysweet/amplihack-agent-eval
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="amplihack-agent-eval" class="md-nav__button md-logo" aria-label="amplihack-agent-eval" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    amplihack-agent-eval
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rysweet/amplihack-agent-eval" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    rysweet/amplihack-agent-eval
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../levels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Evaluation Levels
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../adapters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing Adapters
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Self-Improvement Loop
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-Improvement Loop
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-8-phase-improvement-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 8-Phase Improvement Cycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The 8-Phase Improvement Cycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: EVAL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-analyze" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: ANALYZE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-propose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: PROPOSE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: CHALLENGE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-vote" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: VOTE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: APPLY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-7-re-eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 7: RE-EVAL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-8-decide" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 8: DECIDE
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Data Structures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patchproposal" class="md-nav__link">
    <span class="md-ellipsis">
      
        PatchProposal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patchhistory" class="md-nav__link">
    <span class="md-ellipsis">
      
        PatchHistory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#categoryanalysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        CategoryAnalysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reviewvote" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReviewVote
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challengeresponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        ChallengeResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reviewresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReviewResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runnerresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        RunnerResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterationresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        IterationResult
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safety-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety Constraints
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#programmatic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Programmatic Usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary JSON
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-end-to-end" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works End-to-End
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-multi-seed-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Multi-Seed Evaluation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../multi-agent-eval/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-Agent Eval
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#the-8-phase-improvement-cycle" class="md-nav__link">
    <span class="md-ellipsis">
      
        The 8-Phase Improvement Cycle
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The 8-Phase Improvement Cycle">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 1: EVAL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-analyze" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 2: ANALYZE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-propose" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 3: PROPOSE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-challenge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 4: CHALLENGE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-vote" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 5: VOTE
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-6-apply" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 6: APPLY
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-7-re-eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 7: RE-EVAL
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-8-decide" class="md-nav__link">
    <span class="md-ellipsis">
      
        Phase 8: DECIDE
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configuration
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Data Structures
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patchproposal" class="md-nav__link">
    <span class="md-ellipsis">
      
        PatchProposal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#patchhistory" class="md-nav__link">
    <span class="md-ellipsis">
      
        PatchHistory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#categoryanalysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        CategoryAnalysis
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reviewvote" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReviewVote
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#challengeresponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        ChallengeResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reviewresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReviewResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#runnerresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        RunnerResult
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iterationresult" class="md-nav__link">
    <span class="md-ellipsis">
      
        IterationResult
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#safety-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      
        Safety Constraints
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cli-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        CLI Usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#programmatic-usage" class="md-nav__link">
    <span class="md-ellipsis">
      
        Programmatic Usage
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#output-structure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Output Structure
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Output Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#summary-json" class="md-nav__link">
    <span class="md-ellipsis">
      
        Summary JSON
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-it-works-end-to-end" class="md-nav__link">
    <span class="md-ellipsis">
      
        How It Works End-to-End
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#real-world-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        Real-World Results
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration-with-multi-seed-evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Integration with Multi-Seed Evaluation
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="self-improvement-loop">Self-Improvement Loop<a class="headerlink" href="#self-improvement-loop" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>The self-improvement loop automates the process of identifying evaluation weaknesses and iteratively improving agent performance. It follows a disciplined 8-phase cycle with safety gates at every step, inspired by the principle: <strong>measure first, change second</strong>.</p>
<p>The loop consists of three cooperating modules:</p>
<ul>
<li><strong><code>runner.py</code></strong> -- Orchestrates the 8 phases, manages iteration state, detects regression</li>
<li><strong><code>patch_proposer.py</code></strong> -- LLM-powered analysis of failures, generates hypotheses and unified diffs</li>
<li><strong><code>reviewer_voting.py</code></strong> -- Devil's advocate challenge + 3-reviewer voting (quality, regression, simplicity)</li>
</ul>
<h2 id="the-8-phase-improvement-cycle">The 8-Phase Improvement Cycle<a class="headerlink" href="#the-8-phase-improvement-cycle" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>EVAL -&gt; ANALYZE -&gt; PROPOSE -&gt; CHALLENGE -&gt; VOTE -&gt; APPLY -&gt; RE-EVAL -&gt; DECIDE
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  |                                                                      |
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  +----------------------------------------------------------------------+
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>                           (iterate up to N times)
</code></pre></div>
<h3 id="phase-1-eval">Phase 1: EVAL<a class="headerlink" href="#phase-1-eval" title="Permanent link">&para;</a></h3>
<p>Run the full long-horizon evaluation to get per-category scores.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">evaluator</span> <span class="o">=</span> <span class="n">EvalRunner</span><span class="p">(</span><span class="n">num_turns</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_turns</span><span class="p">,</span> <span class="n">num_questions</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">num_questions</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">report</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">grader_model</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">grader_model</span><span class="p">)</span>
</code></pre></div>
<p>A fresh agent is created from the <code>agent_factory</code> callable at each iteration to ensure clean state. The <code>EvalReport</code> provides <code>overall_score</code>, <code>category_breakdown</code> (per-category averages, min, max, dimension averages), and individual <code>EvalResult</code> entries for every question.</p>
<h3 id="phase-2-analyze">Phase 2: ANALYZE<a class="headerlink" href="#phase-2-analyze" title="Permanent link">&para;</a></h3>
<p>Identify the worst-performing category and diagnose the bottleneck.</p>
<p>The <code>_analyze_categories()</code> function groups all questions by category, identifies questions scoring below <code>failure_threshold</code>, and calls <code>_diagnose_bottleneck()</code> to map the failure to a specific system component.</p>
<p><strong>Bottleneck Diagnosis Mapping:</strong></p>
<p>The framework maps categories to system components using a two-level approach: category-specific mapping first, then fallback to worst-dimension mapping.</p>
<table>
<thead>
<tr>
<th>Category</th>
<th>Bottleneck Component</th>
<th>Suggested Fix Direction</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>needle_in_haystack</code></td>
<td><code>retrieval:keyword_search</code></td>
<td>Entity-centric indexing for people/projects</td>
</tr>
<tr>
<td><code>meta_memory</code></td>
<td><code>retrieval:aggregation</code></td>
<td>Route "how many" / "list all" to COUNT/DISTINCT queries</td>
</tr>
<tr>
<td><code>source_attribution</code></td>
<td><code>retrieval:source_tracking</code></td>
<td>Ensure source_label is included in retrieval results</td>
</tr>
<tr>
<td><code>temporal_evolution</code></td>
<td><code>retrieval:temporal_ordering</code></td>
<td>Ensure temporal_index metadata for chronological sorting</td>
</tr>
<tr>
<td><code>cross_reference</code></td>
<td><code>retrieval:graph_traversal</code></td>
<td>Expand hop depth to connect facts across blocks</td>
</tr>
<tr>
<td><code>numerical_precision</code></td>
<td><code>synthesis:arithmetic</code></td>
<td>Ensure calculate tool is used for all math operations</td>
</tr>
<tr>
<td><code>distractor_resistance</code></td>
<td><code>retrieval:confidence_weighting</code></td>
<td>Deprioritize distractor blocks with lower confidence</td>
</tr>
</tbody>
</table>
<p><strong>Dimension-based fallback</strong> (when no category-specific mapping exists):</p>
<table>
<thead>
<tr>
<th>Worst Dimension</th>
<th>Bottleneck Component</th>
<th>Suggested Fix</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>factual_accuracy</code></td>
<td><code>retrieval:coverage</code></td>
<td>Increase retrieval coverage</td>
</tr>
<tr>
<td><code>specificity</code></td>
<td><code>retrieval:precision</code></td>
<td>Improve retrieval precision</td>
</tr>
<tr>
<td><code>temporal_awareness</code></td>
<td><code>retrieval:temporal</code></td>
<td>Add temporal metadata</td>
</tr>
<tr>
<td><code>source_attribution</code></td>
<td><code>retrieval:provenance</code></td>
<td>Improve source tracking</td>
</tr>
<tr>
<td><code>confidence_calibration</code></td>
<td><code>synthesis:calibration</code></td>
<td>Improve confidence expression</td>
</tr>
</tbody>
</table>
<p>Categories are sorted by average score (worst first). If no categories are below <code>failure_threshold</code>, the loop stops early with a "all categories above threshold" message.</p>
<h3 id="phase-3-propose">Phase 3: PROPOSE<a class="headerlink" href="#phase-3-propose" title="Permanent link">&para;</a></h3>
<p>Use LLM to generate a patch hypothesis targeting the worst category's bottleneck.</p>
<p>The <code>propose_patch()</code> function in <code>patch_proposer.py</code>:</p>
<ol>
<li>
<p><strong>Reads the target file</strong> based on the bottleneck component identifier. A <code>component_file_map</code> can be provided to map component prefixes (e.g., <code>"retrieval:"</code>) to file paths.</p>
</li>
<li>
<p><strong>Builds a structured prompt</strong> containing:</p>
</li>
<li>The failing category name, score, bottleneck, and suggested fix direction</li>
<li>Up to 5 failed questions with their expected vs. actual answers, scores, and per-dimension breakdowns</li>
<li>Previously reverted patches (with revert reasons) -- to prevent repeating failed fixes</li>
<li>Previously rejected patches (with rejection reasons) -- to force different approaches</li>
<li>
<p>The target file's source code (up to 3000 characters)</p>
</li>
<li>
<p><strong>Calls the LLM</strong> to generate a structured JSON response containing:</p>
</li>
<li><code>hypothesis</code> -- why the category is failing</li>
<li><code>description</code> -- what the patch does</li>
<li><code>diff</code> -- unified diff format of the proposed change</li>
<li><code>expected_impact</code> -- mapping of category name to expected score delta in percentage points</li>
<li><code>risk_assessment</code> -- what could go wrong</li>
<li>
<p><code>confidence</code> -- 0.0 to 1.0</p>
</li>
<li>
<p><strong>Returns a <code>PatchProposal</code></strong> dataclass. If no LLM callable is provided, a stub proposal with 10% confidence is returned.</p>
</li>
</ol>
<p><strong>Patch rules enforced by the prompt:</strong></p>
<ul>
<li>The diff must be valid unified diff format</li>
<li>Focus on the SMALLEST change that addresses the root cause</li>
<li>Do NOT change test infrastructure, graders, or eval harness</li>
<li>Prefer prompt/instruction changes over algorithmic changes</li>
<li>Be honest about confidence -- lower is better than overconfident</li>
</ul>
<h3 id="phase-4-challenge">Phase 4: CHALLENGE<a class="headerlink" href="#phase-4-challenge" title="Permanent link">&para;</a></h3>
<p>A devil's advocate reviews the proposal and raises concerns.</p>
<p>The <code>challenge_proposal()</code> function in <code>reviewer_voting.py</code> runs a two-step process:</p>
<p><strong>Step 1 -- Devil's Advocate Attack:</strong></p>
<p>An LLM call with the <code>DEVIL_ADVOCATE_PROMPT</code> argues aggressively against the proposal:
- What assumptions could be wrong?
- What could this break?
- Is there a simpler alternative?
- Is the hypothesis even correct?</p>
<p>The response includes a list of arguments against and a worst-case scenario.</p>
<p><strong>Step 2 -- Proposer Defense:</strong></p>
<p>A second LLM call receives the challenge arguments and the original proposal, then responds with:
- <code>defense</code> -- why the patch should still be applied
- <code>concerns_acknowledged</code> -- valid concerns the proposer acknowledges
- <code>concerns_refuted</code> -- concerns the proposer has addressed</p>
<p><strong>Adequacy Check:</strong></p>
<p>Concerns are considered adequately addressed if the proposer responds to at least 50% of the challenge arguments (acknowledged + refuted &gt;= 50% of total challenges). If concerns are NOT adequately addressed, the proposal is logged as rejected and the iteration skips to the next cycle.</p>
<h3 id="phase-5-vote">Phase 5: VOTE<a class="headerlink" href="#phase-5-vote" title="Permanent link">&para;</a></h3>
<p>Three independent reviewers each vote on the proposal. Each reviewer has a distinct perspective:</p>
<p><strong>Quality Reviewer</strong> -- evaluates:
- Engineering best practices (clean code, no side effects)
- Proper error handling
- Appropriate use of abstractions
- Consistency with existing code style
- Whether the change is testable</p>
<p><strong>Regression Reviewer</strong> -- evaluates:
- Could this change break OTHER categories that currently pass?
- Does it modify shared code paths affecting unrelated functionality?
- Are there edge cases causing unexpected failures?
- Is the change scoped narrowly enough to avoid collateral damage?</p>
<p><strong>Simplicity Reviewer</strong> -- evaluates:
- Is this the SIMPLEST possible fix?
- Could a smaller change achieve the same result?
- Does it add unnecessary complexity or abstraction?
- Could a prompt-only change work instead of a code change?</p>
<p>Each reviewer receives the formatted proposal (including the challenge phase results if available) and responds with a structured JSON vote: <code>accept</code>, <code>reject</code>, or <code>modify</code>, along with a rationale and specific concerns.</p>
<p><strong>Vote Tallying:</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>&gt;50% accept  -&gt; &quot;accepted&quot;
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>&gt;50% reject  -&gt; &quot;rejected&quot;
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>otherwise    -&gt; &quot;modified&quot; (mixed signals)
</code></pre></div>
<p>With 3 reviewers, this means at least 2 must accept for the proposal to pass.</p>
<p>If the proposal is rejected, it is logged in <code>PatchHistory.rejected_patches</code> and the iteration continues to the next cycle.</p>
<h3 id="phase-6-apply">Phase 6: APPLY<a class="headerlink" href="#phase-6-apply" title="Permanent link">&para;</a></h3>
<p>If the majority votes accept, the patch is applied. The proposal is logged in <code>PatchHistory.applied_patches</code> with its target file, description, hypothesis, and confidence.</p>
<h3 id="phase-7-re-eval">Phase 7: RE-EVAL<a class="headerlink" href="#phase-7-re-eval" title="Permanent link">&para;</a></h3>
<p>Run the evaluation again with a fresh agent to measure the patch's impact. The post-evaluation scores are compared against the baseline scores from Phase 1.</p>
<h3 id="phase-8-decide">Phase 8: DECIDE<a class="headerlink" href="#phase-8-decide" title="Permanent link">&para;</a></h3>
<p>The <code>detect_regression()</code> function checks whether any individual category regressed beyond the configured threshold:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">detect_regression</span><span class="p">(</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    <span class="n">baseline_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    <span class="n">post_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>    <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
</code></pre></div>
<p><strong>Regression Detection Logic:</strong></p>
<ol>
<li>Compute the delta (in percentage points) for each category: <code>baseline - post</code></li>
<li>Find the maximum regression across all categories</li>
<li>Find the maximum gain across all categories</li>
<li>Regression is detected if: <code>max_regression &gt; threshold AND max_gain &lt; threshold</code></li>
</ol>
<p>This means a large gain in one category can compensate for a small regression in another, but a large regression without corresponding gains triggers a revert.</p>
<p><strong>If regression detected:</strong> The patch is automatically reverted and logged in <code>PatchHistory.reverted_patches</code> with the revert reason.</p>
<p><strong>If no regression:</strong> The patch is kept and the loop continues.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">amplihack_eval.self_improve.runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">SelfImproveConfig</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SelfImproveConfig</span><span class="p">(</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    <span class="n">num_turns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>              <span class="c1"># Dialogue turns per evaluation</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    <span class="n">num_questions</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>           <span class="c1"># Questions per evaluation</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>                    <span class="c1"># Random seed for reproducibility</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>           <span class="c1"># Maximum improvement iterations</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="n">failure_threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>      <span class="c1"># Scores below this are &quot;failures&quot;</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>    <span class="n">regression_threshold</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>   <span class="c1"># Max regression (pp) before auto-revert</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/self-improve&quot;</span><span class="p">,</span>  <span class="c1"># Where to write logs and reports</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>    <span class="n">grader_model</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>            <span class="c1"># LLM model for grading (default if empty)</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="p">)</span>
</code></pre></div>
<p><strong>Parameter Tuning Guidelines:</strong></p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Conservative</th>
<th>Moderate</th>
<th>Aggressive</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>failure_threshold</code></td>
<td>0.8</td>
<td>0.7</td>
<td>0.5</td>
</tr>
<tr>
<td><code>regression_threshold</code></td>
<td>2.0</td>
<td>5.0</td>
<td>10.0</td>
</tr>
<tr>
<td><code>max_iterations</code></td>
<td>3</td>
<td>5</td>
<td>10</td>
</tr>
<tr>
<td><code>num_turns</code></td>
<td>100</td>
<td>500</td>
<td>1000</td>
</tr>
<tr>
<td><code>num_questions</code></td>
<td>20</td>
<td>50</td>
<td>100</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Conservative</strong>: Strict quality gates, fewer iterations, catches only severe failures</li>
<li><strong>Moderate</strong>: Balanced -- good default for most use cases</li>
<li><strong>Aggressive</strong>: Allows more latitude, more iterations, may find more improvements but risks more churn</li>
</ul>
<h2 id="key-data-structures">Key Data Structures<a class="headerlink" href="#key-data-structures" title="Permanent link">&para;</a></h2>
<h3 id="patchproposal">PatchProposal<a class="headerlink" href="#patchproposal" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">PatchProposal</span><span class="p">:</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="n">target_file</span><span class="p">:</span> <span class="nb">str</span>                       <span class="c1"># Path to the file to modify</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="n">hypothesis</span><span class="p">:</span> <span class="nb">str</span>                        <span class="c1"># Why the category is failing</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>                       <span class="c1"># What the patch does</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">diff</span><span class="p">:</span> <span class="nb">str</span>                              <span class="c1"># Unified diff format</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">expected_impact</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># category -&gt; expected score delta (pp)</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">risk_assessment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>              <span class="c1"># What could go wrong</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>               <span class="c1"># 0.0 to 1.0</span>
</code></pre></div>
<h3 id="patchhistory">PatchHistory<a class="headerlink" href="#patchhistory" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">PatchHistory</span><span class="p">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    <span class="n">applied_patches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># Successfully applied patches</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    <span class="n">reverted_patches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># Patches that caused regression</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>    <span class="n">rejected_patches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>    <span class="c1"># Patches rejected by reviewers</span>
</code></pre></div>
<p>The history is passed to the patch proposer at each iteration. Previously reverted and rejected patches are included in the LLM prompt with their failure reasons, preventing the system from proposing the same fix twice.</p>
<h3 id="categoryanalysis">CategoryAnalysis<a class="headerlink" href="#categoryanalysis" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">CategoryAnalysis</span><span class="p">:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>                          <span class="c1"># Category name</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="n">avg_score</span><span class="p">:</span> <span class="nb">float</span>                       <span class="c1"># Average score</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="n">num_questions</span><span class="p">:</span> <span class="nb">int</span>                     <span class="c1"># Number of questions</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="n">failed_questions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>      <span class="c1"># Details of failed questions</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>    <span class="n">bottleneck</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                   <span class="c1"># Identified system component</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="n">suggested_fix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                <span class="c1"># Suggested improvement direction</span>
</code></pre></div>
<h3 id="reviewvote">ReviewVote<a class="headerlink" href="#reviewvote" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ReviewVote</span><span class="p">:</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>    <span class="n">reviewer_id</span><span class="p">:</span> <span class="nb">str</span>                       <span class="c1"># &quot;quality&quot;, &quot;regression&quot;, or &quot;simplicity&quot;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>    <span class="n">vote</span><span class="p">:</span> <span class="nb">str</span>                              <span class="c1"># &quot;accept&quot;, &quot;reject&quot;, or &quot;modify&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>    <span class="n">rationale</span><span class="p">:</span> <span class="nb">str</span>                         <span class="c1"># Why this vote was cast</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="n">concerns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>              <span class="c1"># Specific concerns</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>    <span class="n">suggested_modifications</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="challengeresponse">ChallengeResponse<a class="headerlink" href="#challengeresponse" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChallengeResponse</span><span class="p">:</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    <span class="n">challenge_arguments</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>         <span class="c1"># Arguments against the patch</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>    <span class="n">proposer_response</span><span class="p">:</span> <span class="nb">str</span>                 <span class="c1"># The proposer&#39;s defense</span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>    <span class="n">concerns_addressed</span><span class="p">:</span> <span class="nb">bool</span>               <span class="c1"># Were &gt;= 50% of concerns addressed?</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>    <span class="n">remaining_concerns</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>     <span class="c1"># Unaddressed concerns</span>
</code></pre></div>
<h3 id="reviewresult">ReviewResult<a class="headerlink" href="#reviewresult" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">ReviewResult</span><span class="p">:</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>    <span class="n">proposal</span><span class="p">:</span> <span class="n">PatchProposal</span>                <span class="c1"># The proposal being reviewed</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="n">challenge</span><span class="p">:</span> <span class="n">ChallengeResponse</span> <span class="o">|</span> <span class="kc">None</span>    <span class="c1"># Challenge phase results</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="n">votes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ReviewVote</span><span class="p">]</span>                <span class="c1"># Individual reviewer votes</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>    <span class="n">decision</span><span class="p">:</span> <span class="nb">str</span>                          <span class="c1"># &quot;accepted&quot;, &quot;rejected&quot;, or &quot;modified&quot;</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="n">consensus_rationale</span><span class="p">:</span> <span class="nb">str</span>               <span class="c1"># Summary rationale</span>
</code></pre></div>
<h3 id="runnerresult">RunnerResult<a class="headerlink" href="#runnerresult" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">RunnerResult</span><span class="p">:</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>                 <span class="c1"># Configuration used</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">iterations</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">IterationResult</span><span class="p">]</span>      <span class="c1"># Per-iteration results</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">score_progression</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>         <span class="c1"># Overall score at each iteration</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">category_progression</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>  <span class="c1"># Per-category scores over time</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">total_duration_seconds</span><span class="p">:</span> <span class="nb">float</span>
</code></pre></div>
<h3 id="iterationresult">IterationResult<a class="headerlink" href="#iterationresult" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nd">@dataclass</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">IterationResult</span><span class="p">:</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span>                         <span class="c1"># Iteration number (1-based)</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>    <span class="n">report</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>                 <span class="c1"># Full EvalReport as dict</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>    <span class="n">category_analyses</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>          <span class="c1"># Per-category failure analysis</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>    <span class="n">improvements_applied</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>        <span class="c1"># Descriptions of applied patches</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>    <span class="n">patch_proposal</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>     <span class="c1"># Proposal details</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>    <span class="n">review_result</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># Review details</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="n">post_scores</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Post-eval scores</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>    <span class="n">reverted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>                 <span class="c1"># Was this patch reverted?</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    <span class="n">revert_reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>                <span class="c1"># Why it was reverted</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="n">duration_seconds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>          <span class="c1"># Iteration wall clock time</span>
</code></pre></div>
<h2 id="safety-constraints">Safety Constraints<a class="headerlink" href="#safety-constraints" title="Permanent link">&para;</a></h2>
<p>The self-improvement loop enforces strict safety rules:</p>
<ol>
<li>
<p><strong>Never modifies the grader</strong>: The grading system is the source of truth. The LLM prompt explicitly forbids changes to test infrastructure, graders, or eval harness.</p>
</li>
<li>
<p><strong>Never modifies test data</strong>: Test levels and questions are fixed. Data generation is deterministic and untouchable.</p>
</li>
<li>
<p><strong>Never weakens safety constraints</strong>: The challenge and voting phases cannot be circumvented. Even if an LLM proposes removing safety gates, reviewers would reject it.</p>
</li>
<li>
<p><strong>Auto-revert on regression</strong>: If the overall score or any category drops by more than <code>regression_threshold</code> percentage points, the patch is automatically reverted. This protects existing quality from well-intentioned but harmful changes.</p>
</li>
<li>
<p><strong>Full history prevents repetition</strong>: All attempted patches (applied, reverted, rejected) are tracked in <code>PatchHistory</code> and included in future proposal prompts, preventing the system from proposing the same failed fix repeatedly.</p>
</li>
<li>
<p><strong>Majority vote required</strong>: No patch is applied without at least 2/3 reviewers voting to accept.</p>
</li>
<li>
<p><strong>Devil's advocate gate</strong>: Proposals that fail the challenge phase (less than 50% of concerns addressed) are rejected before reaching the voting stage.</p>
</li>
</ol>
<h2 id="cli-usage">CLI Usage<a class="headerlink" href="#cli-usage" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Run 5 iterations of self-improvement</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>amplihack-eval<span class="w"> </span>self-improve<span class="w"> </span>--iterations<span class="w"> </span><span class="m">5</span><span class="w"> </span>--turns<span class="w"> </span><span class="m">100</span><span class="w"> </span>--questions<span class="w"> </span><span class="m">20</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="c1"># Large-scale improvement with custom output</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>amplihack-eval<span class="w"> </span>self-improve<span class="w"> </span>--iterations<span class="w"> </span><span class="m">10</span><span class="w"> </span>--turns<span class="w"> </span><span class="m">500</span><span class="w"> </span>--questions<span class="w"> </span><span class="m">50</span><span class="w"> </span>--output-dir<span class="w"> </span>./logs
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="c1"># Conservative settings (strict regression threshold)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>amplihack-eval<span class="w"> </span>self-improve<span class="w"> </span>--iterations<span class="w"> </span><span class="m">3</span><span class="w"> </span>--regression-threshold<span class="w"> </span><span class="m">2</span>.0
</code></pre></div>
<h2 id="programmatic-usage">Programmatic Usage<a class="headerlink" href="#programmatic-usage" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">amplihack_eval.self_improve.runner</span><span class="w"> </span><span class="kn">import</span> <span class="n">SelfImproveConfig</span><span class="p">,</span> <span class="n">run_self_improve</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">amplihack_eval.adapters.learning_agent</span><span class="w"> </span><span class="kn">import</span> <span class="n">LearningAgentAdapter</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">config</span> <span class="o">=</span> <span class="n">SelfImproveConfig</span><span class="p">(</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    <span class="n">num_turns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">num_questions</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">max_iterations</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">failure_threshold</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">regression_threshold</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;/tmp/self-improve&quot;</span><span class="p">,</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="p">)</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="c1"># Agent factory creates a fresh agent for each iteration</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="k">def</span><span class="w"> </span><span class="nf">make_agent</span><span class="p">():</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    <span class="k">return</span> <span class="n">LearningAgentAdapter</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-sonnet-4-5-20250929&quot;</span><span class="p">)</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="c1"># Optional: provide an LLM callable for patch proposal and review</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="kn">import</span><span class="w"> </span><span class="nn">anthropic</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="n">client</span> <span class="o">=</span> <span class="n">anthropic</span><span class="o">.</span><span class="n">Anthropic</span><span class="p">()</span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">llm_call</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;claude-sonnet-4-5-20250929&quot;</span><span class="p">,</span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a>        <span class="n">max_tokens</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>        <span class="n">messages</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">}],</span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>    <span class="p">)</span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a>    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="c1"># Run the loop</span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="n">result</span> <span class="o">=</span> <span class="n">run_self_improve</span><span class="p">(</span>
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a>    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#__codelineno-14-32"></a>    <span class="n">agent_factory</span><span class="o">=</span><span class="n">make_agent</span><span class="p">,</span>
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#__codelineno-14-33"></a>    <span class="n">llm_call</span><span class="o">=</span><span class="n">llm_call</span><span class="p">,</span>
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#__codelineno-14-34"></a>    <span class="n">project_root</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/path/to/agent/code&quot;</span><span class="p">),</span>
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#__codelineno-14-35"></a><span class="p">)</span>
<a id="__codelineno-14-36" name="__codelineno-14-36" href="#__codelineno-14-36"></a>
<a id="__codelineno-14-37" name="__codelineno-14-37" href="#__codelineno-14-37"></a><span class="c1"># Inspect results</span>
<a id="__codelineno-14-38" name="__codelineno-14-38" href="#__codelineno-14-38"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iterations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">iterations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-39" name="__codelineno-14-39" href="#__codelineno-14-39"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Score progression: </span><span class="si">{</span><span class="s1">&#39; -&gt; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s1">.2%</span><span class="si">}</span><span class="s1">&#39;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">result</span><span class="o">.</span><span class="n">score_progression</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-40" name="__codelineno-14-40" href="#__codelineno-14-40"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duration: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">total_duration_seconds</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
<a id="__codelineno-14-41" name="__codelineno-14-41" href="#__codelineno-14-41"></a>
<a id="__codelineno-14-42" name="__codelineno-14-42" href="#__codelineno-14-42"></a><span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">iterations</span><span class="p">:</span>
<a id="__codelineno-14-43" name="__codelineno-14-43" href="#__codelineno-14-43"></a>    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;REVERTED&quot;</span> <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">reverted</span> <span class="k">else</span> <span class="s2">&quot;KEPT&quot;</span>
<a id="__codelineno-14-44" name="__codelineno-14-44" href="#__codelineno-14-44"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Iteration </span><span class="si">{</span><span class="n">it</span><span class="o">.</span><span class="n">iteration</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-45" name="__codelineno-14-45" href="#__codelineno-14-45"></a>    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">patch_proposal</span><span class="p">:</span>
<a id="__codelineno-14-46" name="__codelineno-14-46" href="#__codelineno-14-46"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Patch: </span><span class="si">{</span><span class="n">it</span><span class="o">.</span><span class="n">patch_proposal</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)[:</span><span class="mi">80</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-14-47" name="__codelineno-14-47" href="#__codelineno-14-47"></a>    <span class="k">if</span> <span class="n">it</span><span class="o">.</span><span class="n">review_result</span><span class="p">:</span>
<a id="__codelineno-14-48" name="__codelineno-14-48" href="#__codelineno-14-48"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Review: </span><span class="si">{</span><span class="n">it</span><span class="o">.</span><span class="n">review_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;decision&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="output-structure">Output Structure<a class="headerlink" href="#output-structure" title="Permanent link">&para;</a></h2>
<p>Each run produces files in the output directory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>/tmp/self-improve/
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    self_improve_summary.json       # High-level summary
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>    iteration_1/
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>        report.json                 # Full EvalReport from Phase 1
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>    iteration_2/
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>        report.json
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>    ...
</code></pre></div>
<h3 id="summary-json">Summary JSON<a class="headerlink" href="#summary-json" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="nt">&quot;config&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">        </span><span class="nt">&quot;num_turns&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">        </span><span class="nt">&quot;num_questions&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">        </span><span class="nt">&quot;max_iterations&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">        </span><span class="nt">&quot;failure_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">        </span><span class="nt">&quot;regression_threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">5.0</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="nt">&quot;score_progression&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.72</span><span class="p">,</span><span class="w"> </span><span class="mf">0.78</span><span class="p">,</span><span class="w"> </span><span class="mf">0.82</span><span class="p">,</span><span class="w"> </span><span class="mf">0.85</span><span class="p">],</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="nt">&quot;category_progression&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="nt">&quot;needle_in_haystack&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.88</span><span class="p">,</span><span class="w"> </span><span class="mf">0.90</span><span class="p">,</span><span class="w"> </span><span class="mf">0.92</span><span class="p">,</span><span class="w"> </span><span class="mf">0.92</span><span class="p">],</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">        </span><span class="nt">&quot;temporal_evolution&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.55</span><span class="p">,</span><span class="w"> </span><span class="mf">0.68</span><span class="p">,</span><span class="w"> </span><span class="mf">0.72</span><span class="p">,</span><span class="w"> </span><span class="mf">0.78</span><span class="p">],</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">        </span><span class="nt">&quot;numerical_precision&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mf">0.62</span><span class="p">,</span><span class="w"> </span><span class="mf">0.65</span><span class="p">,</span><span class="w"> </span><span class="mf">0.70</span><span class="p">,</span><span class="w"> </span><span class="mf">0.75</span><span class="p">]</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="w">    </span><span class="nt">&quot;total_duration_seconds&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">342.5</span><span class="p">,</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="nt">&quot;iterations_run&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a><span class="w">    </span><span class="nt">&quot;patches_applied&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="w">    </span><span class="nt">&quot;patches_reverted&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="nt">&quot;patches_rejected&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="p">}</span>
</code></pre></div>
<h2 id="how-it-works-end-to-end">How It Works End-to-End<a class="headerlink" href="#how-it-works-end-to-end" title="Permanent link">&para;</a></h2>
<p>A typical 5-iteration run:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>Iteration 1:
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>  EVAL:      Overall 72%, temporal_evolution at 55% (worst)
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>  ANALYZE:   Bottleneck: retrieval:temporal_ordering
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  PROPOSE:   &quot;Add temporal_index metadata to all time-series facts&quot;
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>  CHALLENGE: 3 arguments raised, 2 addressed, 1 remaining -&gt; PASS
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>  VOTE:      quality=accept, regression=accept, simplicity=modify -&gt; ACCEPTED
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>  APPLY:     Patch applied
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>  RE-EVAL:   temporal_evolution 55% -&gt; 68%, overall 72% -&gt; 78%
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>  DECIDE:    No regression -&gt; KEEP
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>Iteration 2:
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>  EVAL:      Overall 78%, numerical_precision at 62% (worst)
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>  ANALYZE:   Bottleneck: synthesis:arithmetic
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>  PROPOSE:   &quot;Route math questions to calculate tool&quot;
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>  CHALLENGE: 2 arguments raised, 2 addressed -&gt; PASS
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>  VOTE:      quality=accept, regression=reject, simplicity=accept -&gt; ACCEPTED
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>  APPLY:     Patch applied
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>  RE-EVAL:   numerical_precision 62% -&gt; 70%, but source_attribution 80% -&gt; 72%
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>  DECIDE:    source_attribution regressed 8pp &gt; 5pp threshold -&gt; REVERT
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a>Iteration 3:
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a>  EVAL:      Overall 78% (reverted to pre-iteration-2 state)
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>  ANALYZE:   numerical_precision at 62% (same as before, different approach needed)
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a>  PROPOSE:   &quot;Add arithmetic verification step to synthesis prompt&quot;
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a>             (History shows previous approach was reverted due to regression)
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a>  CHALLENGE: 2 arguments raised, 2 addressed -&gt; PASS
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>  VOTE:      quality=accept, regression=accept, simplicity=accept -&gt; ACCEPTED
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a>  APPLY:     Patch applied
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a>  RE-EVAL:   numerical_precision 62% -&gt; 73%, no regressions
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a>  DECIDE:    No regression -&gt; KEEP
</code></pre></div>
<h2 id="real-world-results">Real-World Results<a class="headerlink" href="#real-world-results" title="Permanent link">&para;</a></h2>
<p>From the amplihack development history (5-loop improvement cycle):</p>
<ul>
<li><strong>Starting score</strong>: 83.2%</li>
<li><strong>Final score</strong>: 96.6% (+13.4 percentage points)</li>
<li><strong>Biggest single improvement</strong>: Source-specific fact filtering, +53.3% on L2 (multi-source synthesis)</li>
<li><strong>Key insight</strong>: Retrieval threshold of 50 was too low; increasing to 150 prevented cascading failures as the knowledge base grew</li>
</ul>
<h2 id="integration-with-multi-seed-evaluation">Integration with Multi-Seed Evaluation<a class="headerlink" href="#integration-with-multi-seed-evaluation" title="Permanent link">&para;</a></h2>
<p>For more robust improvement decisions, combine self-improvement with multi-seed evaluation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">amplihack_eval.core.multi_seed</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_multi_seed_eval</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="c1"># After each improvement iteration, validate across multiple seeds</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">seeds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">42</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">456</span><span class="p">,</span> <span class="mi">789</span><span class="p">]</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="n">multi_result</span> <span class="o">=</span> <span class="n">run_multi_seed_eval</span><span class="p">(</span><span class="n">agent</span><span class="p">,</span> <span class="n">seeds</span><span class="o">=</span><span class="n">seeds</span><span class="p">,</span> <span class="n">num_turns</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">num_questions</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="c1"># Check if improvement is consistent across seeds (not just lucky on seed=42)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="k">if</span> <span class="n">multi_result</span><span class="o">.</span><span class="n">inter_seed_variance</span><span class="p">[</span><span class="s2">&quot;temporal_evolution&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.10</span><span class="p">:</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;WARNING: High variance -- improvement may be seed-dependent&quot;</span><span class="p">)</span>
</code></pre></div>
<p>This guards against improvements that only work with specific random seeds.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.instant", "navigation.sections", "navigation.expand", "navigation.top", "content.code.copy", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>